services:
  birdhomie:
    image: ghcr.io/dewey/birdhomie:latest
    # Alternatively, build locally:
    # build: .
    container_name: birdhomie
    restart: unless-stopped
    ports:
      - "5000:5000"
    volumes:
      - birdhomie-data:/app/data
    environment:
      # Required: UniFi Protect NVR settings
      - UFP_ADDRESS=192.168.1.1
      - UFP_USERNAME=your-username
      - UFP_PASSWORD=your-password
      - UFP_CAMERA_ID=your-camera-id

      # Optional: Detection settings
      - UFP_DETECTION_TYPES=motion
      - UFP_SSL_VERIFY=0
      - UFP_DOWNLOAD_INTERVAL_MINUTES=60
      - PROCESSOR_INTERVAL_MINUTES=5
      - PROCESSOR_WORKERS=1  # Number of files to process in parallel

      # Optional: Confidence thresholds
      - MIN_SPECIES_CONFIDENCE=0.85
      - MIN_DETECTION_CONFIDENCE=0.80
      - FRAME_SKIP=5
      - FILE_RETENTION_DAYS=30

      # Optional: Flask/Gunicorn settings
      - FLASK_DEBUG=0
      - SECRET_KEY=change-me-to-a-random-string
      - GUNICORN_WORKERS=2  # Number of web server workers
      - PORT=5000  # Web server port

      # Optional: PyTorch CPU optimization
      # NNPACK_DISABLE=1 prevents NNPACK initialization warnings on unsupported hardware
      # Also improves performance on older CPUs without AVX2/FMA (Intel pre-2013, AMD pre-2015)
      # - NNPACK_DISABLE=1

      # Optional: HuggingFace authentication
      # Add your HF token to avoid rate limits when downloading BioCLIP model
      # Get token from: https://huggingface.co/settings/tokens
      # - HF_TOKEN=your-huggingface-token-here

volumes:
  birdhomie-data:
